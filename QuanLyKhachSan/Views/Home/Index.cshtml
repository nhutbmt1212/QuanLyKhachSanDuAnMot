@using System.Security.Claims;
<style>

</style>
<main>
	<ul class="box-info">
		<li>
			<i class='bx bxs-dollar-circle'></i>
			<span class="text">
				<h4 id="TongThuNhap"></h4>
				<p>Tổng thu nhập</p>
			</span>
		</li>
		<li>
			<i class='bx bxs-group'></i>
			<span class="text">
				<h4 id="SoLuongKhachHang">2834</h4>
				<p>Khách hàng</p>
			</span>
		</li>
		<li>
			<i class='bx bxs-calendar-check'></i>
			<span class="text">
				<h3>43</h3>
				<p>Phòng đã thuê</p>
			</span>
		</li>
	</ul>

	<div class="table-data">
		<div class="order" >
			<div class="head">
				<h3>Tổng quan thu nhập</h3>
			</div>
			<hr>
			<div class="col-xl-7 col-lg-7">
				<div class="card shadow mb-4">
					<!-- Card Body -->
					<div class="card-body">
						<div class="chart-area">
							<canvas id="myAreaChart"></canvas>
						</div>
					</div>
				</div>
			</div>

		</div>
		<div class="todo">
			<div class="head">
				<h3>Tình trạng phòng</h3>
			</div>
			<div class="col-xl-7 col-lg-7">
				<div class="card shadow mb-4">
					<!-- Card Body -->
					<div class="card-body" style="width: 350px;">

						<div class="chart-pie pt-4 pb-2">
							<canvas id="myPieChart"></canvas>
						</div>
						<div class="mt-4 text-center small" style="font-size:1em">
							<span class="mr-2">
								<i class="fas fa-circle text-primary"></i>Phòng trống(<span id="phongTrong"></span>)
							</span>
							<span class="mr-2">
								<i class="fas fa-circle text-success"></i> Đang thuê(<span id="phongDaDat"></span>)
							</span>
							
						</div>
					</div>
				</div>
			</div>
		
				
		</div>
	</div>

</main>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
	fetch('/Home/LaySoLuongKhachHang', {
		method: 'POST',
		headers: {
			'Content-Type': 'application/json'
		}
	})
		.then(response => response.json())
		.then(data => {
			// Lưu số lượng khách hàng vào biến
			var soluongkhachhang = data.soluongkhachahng;

			// Hiển thị số lượng khách hàng
			document.getElementById('SoLuongKhachHang').textContent = soluongkhachhang;
		})
		.catch(error => console.error('Có lỗi xảy ra:', error));

</script>
<script>


	fetch('/Home/LayDoanhThuTheoThang')
		.then(response => response.json())
		.then(doanhThuTheoThang => {
			// Tạo một mảng để lưu trữ tổng thu nhập cho mỗi tháng
			var tongThuNhap = new Array(12).fill(0);
			for (var i = 0; i < doanhThuTheoThang.length; i++) {
				// Lưu ý rằng chỉ số của mảng bắt đầu từ 0
				tongThuNhap[i] = doanhThuTheoThang[i];
				console.log(i);
				console.log(tongThuNhap[i]);
			}
			// Bây giờ bạn có thể sử dụng tongThuNhap cho dữ liệu của biểu đồ
			var areaChartData = {
				labels: ['Tháng 1', 'Tháng 2', 'Tháng 3', 'Tháng 4', 'Tháng 5', 'Tháng 6', 'Tháng 7', 'Tháng 8', 'Tháng 9', 'Tháng 10', 'Tháng 11', 'Tháng 12'],
				datasets: [{
					label: 'Tổng thu nhập',
					data: tongThuNhap,
					backgroundColor: 'rgba(75, 192, 192, 0.2)',
					borderColor: 'rgba(75, 192, 192, 1)',
					borderWidth: 1
				}]
			};

			var areaChartCanvas = document.getElementById('myAreaChart').getContext('2d');
			var areaChart = new Chart(areaChartCanvas, {
				type: 'line',
				data: areaChartData,
				options: {
					scales: {
						x: {
							beginAtZero: true
						},
						y: {
							beginAtZero: true
						}
					}
				}
			});
		});

	fetch('/Home/LayThuNhapTheoNam')
		.then(response => response.json())
		.then(data => {
			// Định dạng số với dấu chấm sau mỗi 3 chữ số
			var formattedData = data.toLocaleString('de-DE');

			// Cập nhật dữ liệu HTML với tổng thu nhập
			document.getElementById('TongThuNhap').textContent = formattedData + ' VNĐ';
		})
		.catch(error => console.error('Có lỗi xảy ra:', error));




	var today = new Date();
	var month = (today.getMonth() + 1).toString().padStart(2, '0'); // tháng bắt đầu từ 0 trong JavaScript
	var year = today.getFullYear();
	document.getElementById('monthYearInput').value = year + '-' + month; // đặt giá trị cho input

	$(document).ready(function () {
		// Hàm để lấy tổng thu nhập theo tháng
		function getIncomeByMonth(year, month) {
			$.ajax({
				url: '/Home/LayThuNhapTheoThang',
				type: 'GET',
				data: { year: year, month: month },
				dataType: 'json',
				success: function (data) {
					// Cập nhật dữ liệu HTML với tổng thu nhập
					$('#ThuNhapThang').text(data + ' VNĐ');
				}
			});
		}

		// Sự kiện khi thay đổi tháng
		$('#monthYearInput').on('change', function () {
			var selectedMonth = $(this).val(); // lấy tháng được chọn
			var year = selectedMonth.split('-')[0];
			var month = selectedMonth.split('-')[1];

			getIncomeByMonth(year, month);
		});

		// Sự kiện load trang
		var today = new Date();
		var month = (today.getMonth() + 1).toString().padStart(2, '0'); // tháng bắt đầu từ 0 trong JavaScript
		var year = today.getFullYear();

		getIncomeByMonth(year, month);
	});
</script>
<script>
	var phongTrong;
	var PhongDaDat;

	// Gửi yêu cầu fetch đến controller
	fetch('/Home/LayTinhTrangPhong', {
		method: 'POST',
		headers: {
			'Content-Type': 'application/json'
		}
	})
		.then(response => response.json())
		.then(data => {
			// Cập nhật giá trị cho hai biến
			phongTrong = data.PhongTrong;
			PhongDaDat = data.phongDaDat;

			// Lấy phần tử canvas từ HTML
			var ctx = document.getElementById('myPieChart').getContext('2d');

			// Tạo dữ liệu mẫu
			var data = {
				datasets: [{
					data: [phongTrong, PhongDaDat],
					backgroundColor: ['#4e73df', '#1cc88a'],
				}],
				labels: [
					'Phòng trống',
					'Đang thuê'
				]
			};

			// Tạo biểu đồ pie
			var myPieChart = new Chart(ctx, {
				type: 'pie',
				data: data,
			});

			// Cập nhật số lượng phòng trống và phòng đã đặt
			document.getElementById('phongTrong').textContent = data.datasets[0].data[0];
			document.getElementById('phongDaDat').textContent = data.datasets[0].data[1];
		})
		.catch(error => console.log('Có lỗi xảy ra: ', error));


</script>

