
@model List<QuanLyKhachSan.Models.ChiTietPhongVatTu>
@inject ApplicationDbContext _db;
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <style>
        .popup-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(66, 64, 64, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1;
        }

        .popup-content {
            width: 100%;
            height: 80%;
            max-width: 60vw;
            /* Giới hạn chiều rộng tối đa */
            background-color: white;
            padding: 25px;
            border: 2px solid #ccc;
            border-radius: 8px;
            overflow-y: auto;
            max-height: 130vw;
            overflow-y: auto;
        }

        .close-icon {
            position: absolute;
            font-size: 20px;
            top: 5px;
            right: 10px;
            cursor: pointer;
        }

        .popup button {
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        .form-popup {
            display: none;
            border: 3px solid #f1f1f1;
            z-index: 9;
        }

        .form-popupEdit {
            display: none;
            border: 3px solid #f1f1f1;
            z-index: 9;
        }

        .form-container .btn {
            background-color: #04AA6D;
            color: white;
            padding: 16px 20px;
            border: none;
            cursor: pointer;
            width: 100%;
            /* Thay đổi từ 100% thành 100% */
            margin-bottom: 10px;
            opacity: 0.8;
        }

        .form-container .cancel {
            background-color: red;
        }
    </style>
</head>

<body>
    <!-- Breadcrumb and other structural elements if needed -->
    <div class="mt-3">
        <section>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a asp-action="Index" asp-controller="Home">Tổng quan</a></li>
                <li class="breadcrumb-item active" aria-current="page">Quản lý vật tư phòng</li>
            </ol>
        </section>

        <!-- Popup Thêm vật tư phòng -->
        <div class="form-popup mb-2" id="myForm">
            <form class="form-container" id="myFormContainer">
                <h1 style="font-family:Roboto;">Thêm vật tư phòng</h1>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>Tên phòng</label>
                            <select class="form-control" name="maloaiphong" id="inputFieldChonPhong">
                                <option value="">Chọn phòng</option>
                                @{
                                    var qr_Phong = _db.Phong.ToList();
                                    var qr_VatTu = _db.VatTu.ToList();
                                }
                                @foreach (var phong in qr_Phong)
                                {
                                    var qr_LoaiPhong = _db.LoaiPhong.FirstOrDefault(s => s.MaLoaiPhong == phong.MaLoaiPhong);
                                    <option value="@phong.MaPhong">
                                        @phong.MaPhong - @qr_LoaiPhong.TenLoaiPhong
                                    </option>
                                }
                            </select>
                            <span id="errorMaP" style="color: red;"></span>
                        </div>
                      
                    </div>
                    <div class="col-md-4">

                        <div class="form-group">
                            <label>Tên vật tư</label>
                            <select class="form-control" name="maloaiphong" id="inputFieldChonVatTu">
                                @foreach (var vattu in qr_VatTu)
                                {
                                   <option value="@vattu.MaVatTu">
                                        @vattu.MaVatTu - @vattu.TenVatTu
                                   </option>
                                }
                            </select>
                            <span id="errorChonLP" style="color: red;"></span>
                        </div>
                       
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>Số lượng</label>
                            <input class="form-control" name="ngaytao" type="number" id="inputFieldSoLuong" />
                            <span id="errorNgayTao" style="color: red;"></span>
                        </div>
                    </div>
                </div>

                <div class="clearfix">
                    <button class="btn align-middle m-2 w-25 btn " style="min-width:200px" type="submit"
                            onclick="ThemVatTu()">
                        Thêm vật tư vào phòng
                    </button>
                    <button type="button" class="btn align-middle m-2 w-25  cancel" onclick="closeForm()">Đóng</button>
                </div>
            </form>
        </div>

        <!-- Popup Sửa vật tư phòng -->
        <div class="form-popupEdit mb-2" id="myFormEdit">
            <form class="form-container" id="myFormContainer">
                <h1 style="font-family:Roboto;">Sửa vật tư phòng</h1>
                <div class="row">
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>Tên phòng</label>
                            <input class="form-control" id="inputEditMaPhong" name="ngaytao" type="text" readonly />
                            <span id="errorMaP" style="color: red;"></span>
                        </div>
                        <div class="form-group">
                            <label>Tên vật tư</label>
                            <input class="form-control" id="inputEditMaVatTu" name="ngaytao" type="text" readonly />
                            <span id="errorChonLP" style="color: red;"></span>
                        </div>
                    </div>
                    <div class="col-md-4">

                        <div class="form-group">
                            <label>Số lượng</label>
                            <input class="form-control" id="inputEditSoLuong" name="ngaytao" type="number" id="inputFieldNgayTao" />
                            <span id="errorNgayTao" style="color: red;"></span>
                        </div>
                       
                    </div>
                    <div class="col-md-4">
                        <label>Tình trạng</label>
                        <select class="form-control" id="inputEditTinhTrang" name="maloaiphong" id="inputFieldChonLP">
                            
                            <option value="Đang hoạt động">
                                Đang hoạt động
                            </option>
                            <option value="Đã hư">
                                Đã hư
                            </option>
                            <option value="Đang sửa">
                                Đang sửa
                            </option>
                        </select>
                    </div>
                </div>

                <div class="clearfix">
                    <button class="btn align-middle m-2 w-25 btn-success" id="btn-ThemvtPhong" style="min-width:200px"
                            type="submit" onclick="SuaVatTuPhong()">
                        Sửa vật tư
                    </button>
                    <button type="button" class="btn align-middle m-2 w-25  cancel"
                            onclick="closeFormEdit()">
                        Đóng
                    </button>
                </div>
            </form>
        </div>


        <div class="row">
            <div class="col-sm-4">
                <a class="btn btn-primary text-white" id="btn_themPhong" onclick="openForm()">Thêm Vật tư phòng</a>
            </div>
            <div class="col-sm-6">
                <input type="text" id="searchInput" class="form-control mb-3" placeholder="Tìm kiếm">
            </div>
        </div>
        <!-- Table to display room reservations -->
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Phòng</th>
                        <th scope="col">Vật tư</th>
                        <th scope="col">Số lượng</th>
                        <th scope="col">Tình trạng</th>

                        <th scope="col" class="thead_xuly">Xử lý</th>
                    </tr>
                </thead>
                @{
                    int stt = 0;
                }
                <tbody>
                

                        @foreach(var item in Model)
                         {
                         
                        stt = stt + 1;
                        <tr>
                            @{
                                var qr_Phong_chitiet = _db.Phong.FirstOrDefault(s => s.MaPhong == item.MaPhong);
                                var qr_LoaiPhong = _db.LoaiPhong.FirstOrDefault(s => s.MaLoaiPhong == qr_Phong_chitiet.MaLoaiPhong);
                                var qr_VatTu_chitiet = _db.VatTu.FirstOrDefault(s => s.MaVatTu == item.MaVatTu);
                            }
                            <td scope="row">@stt</td>
                            <th>@item.MaPhong - @qr_LoaiPhong.TenLoaiPhong</th>
                            <td>@item.MaVatTu - @qr_VatTu_chitiet.TenVatTu</td>
                            <td>@item.SoLuong</td>
                            <td>@item.TinhTrang</td>

                        <td>
                                <button class="btn btn-primary btn-sm" id="btn_Sua" onclick="SuaVatTu(this, '@item.MaPhong', '@item.MaVatTu', '@item.SoLuong', '@item.TinhTrang')">Sửa</button>

                            <button class="btn btn-danger btn-sm" onclick="XoaVatTuPhong('@item.MaVatTu', '@item.MaPhong')">
                                Xóa
                            </button>
                            </td>
                        </tr>
                        }
                   </tbody>
            </table>
        </div>
    </div>


    <script src="~/js/JsPhongVatTu.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    @* <script src="https://cdn.jsdelivr.net/npm/popperjs/core@2.9.3/dist/umd/popper.min.js"></script> *@
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#searchInput").on("keyup", function () {
                var value = $(this).val().toLowerCase();
                $("table tbody tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                });
            });

            // Bắt sự kiện thay đổi giá trị trong dropdown "Show"
            $('select[name="example_length"]').on('change', function () {
                var selectedValue = $(this).val();
                $('#formExample').submit(); // Gửi biểu mẫu khi giá trị thay đổi
            });
        });
    </script>
    <script>
        var btn_them = document.getElementById('btn_themPhong');

        function openForm() {
            document.getElementById("myForm").style.display = "block";
            btn_them.style.display = 'none';
        }

        function closeForm() {
            document.getElementById("myForm").style.display = "none";
            btn_them.style.display = 'block';

        }

        var btn_sua = document.getElementById('btn_Sua');
       

        function closeFormEdit() {
            document.getElementById("myFormEdit").style.display = "none";
            // btn_sua.style.display = 'block';

        }
        document.getElementById('btn_themPhong').addEventListener('click', hidePopUpEditNhanVien);

        function hidePopUpEditNhanVien() {
            document.getElementById('myFormEdit').style.display = 'none';
        }

    </script>

</body>

</html>